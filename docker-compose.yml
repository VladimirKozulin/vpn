# Docker Compose для разработки с hot-reload

services:
  # VPN сервер (Spring Boot + Xray)
  vpn-server:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: vpn-server
    ports:
      - "8080:8080"
      - "443:443"
    environment:
      - VPN_XRAY_PATH=/opt/xray/xray
      - VPN_XRAY_PORT=443
      - VPN_SERVER_ADDRESS=192.168.0.9
      - TARANTOOL_HOST=tarantool
      - TARANTOOL_PORT=3301
      - TARANTOOL_USERNAME=admin
      - TARANTOOL_PASSWORD=secret
    volumes:
      - .:/app
      - gradle-cache:/home/gradle/.gradle
    networks:
      - vpn-network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    depends_on:
      - tarantool

  # Tarantool база данных
  tarantool:
    image: tarantool/tarantool:2.11
    container_name: tarantool
    ports:
      - "3301:3301"
    environment:
      - TARANTOOL_USER_NAME=admin
      - TARANTOOL_USER_PASSWORD=secret
    volumes:
      - tarantool-data:/var/lib/tarantool
      - ./tarantool-init.lua:/opt/tarantool/app.lua
    networks:
      - vpn-network
    command: tarantool /opt/tarantool/app.lua

  # Tarantool Admin UI (официальный веб-интерфейс)
  tarantool-ui:
    image: basiscompany/tarantool-admin
    container_name: tarantool-ui
    ports:
      - "8082:80"
    environment:
      - TARANTOOL_HOST=tarantool
      - TARANTOOL_PORT=3301
      - TARANTOOL_USER=admin
      - TARANTOOL_PASSWORD=secret
    networks:
      - vpn-network
    depends_on:
      - tarantool
    restart: unless-stopped

volumes:
  gradle-cache:
  tarantool-data:

networks:
  vpn-network:
    driver: bridge
